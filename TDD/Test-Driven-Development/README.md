# Test Driven Development
書籍テスト駆動開発を学習するRepository

## 学習情報
### 1回目
- 言語：Python
- 対象：第一部 多国通貨
- 対象：第二部 xUnit

#### 学んだこと
- TDDのサイクル
    - Build Error
    - Red
        - Red状態を解決するために `インターフェース` を変更する場合は、テストを変更しても良い
            - 基本的にはRedのテストを修正する。 `Pass` しているテストは変更しない。
    - Green
        - ここまで**最短**で到達することが目標
        - **動作する**コードを作る
            - **振る舞い**を決める議論をする
    - Refactoring
        - **きれいな**コードにする
            - **最善の方法**を見つける議論をする
- 重複を取り除くことで依存性も取り除くことができる
    - 依存する箇所を限定できる
    - 重複と依存関係は `プロダクトコード` と `テストコード` の間にもある
- Pythonでメソッドが所属するクラスの名前が使えない。
    - `from __future__ import annotations` を使う必要がある。
- `感情をテストに翻訳する` TDDのテーマの1つ
    - 2章の `Dollarの副作用` は副作用の不快感を同じインスタンスに複数回掛け算をするテストで表した
    - 7章の `FrancとDollarを比較する` では気になる動作を確認することをテストで表した
- `Value Objectパターン`のメリット
    - 別名参照問題を解決する。
        - 別名参照とは別々のインスタンスA, Bに別名で同じインスタンスCを持たせること
            - インスタンスCを変更するとインスタンスA, Bの両方が変化して予期せぬ不具合になりやすい。
    - `equals()` メソッドを含む
    - `hashCode()` メソッドを含む
- 三角測量
    - 複数のテストを用意してより一般的な実装方法を導き出す方法
        - 無理に使う必要は無い。実装手段が思いつかない場合などに活用すると良い!!
- 1つの機能が正しく動くことを前提にテストを作ることも有る
    - `Green` を疑う必要は無い。
        - 間違いに気づいたら学び、反省してまた勇ましく進む
- 不要なサブクラスは削除したほうがいい。
    - 全ての概念を個別のクラスを使って表現する必要はない。
        - 一つのクラスのメンバー変数などで複数の概念を表すこともできる。
        - 設計がシンプルになる。
            - クラスが多いことを嫌う必要は無いが不要なクラスは消してもいいと気付けることも大切
- 不要なテストも削除した方がいい
    - コードの進化を阻害する可能性の有るコードは削除する。
- リファクタリングの方法
    - 一つのパターンでまずは動くようにする
        - 他のパターンでも動くようにベタ書きの部分を変更する。
            - ベタ書きはmethod名も含まれる場合が有る。 `Pluggable Selectorパターンを`などを参照
            - `Pluggable Selectorパターン`はデメリットとして静的解析ツールが機能しなくなる。（動的型付け言語のメリット？）
- TDDの一度に開発するボリュームは自分の力量に合わせて柔軟に変化させていよい
    - ただし、意図しないエラーに出会ったときにできるだけ小さなステップに戻れるように細かいステップを刻む方法は習得すべきである。

#### わからなかったこと
##### 第一部
- P.9 のコラムのTDDの第2のルールとは？
- p.38 のFrancクラスの `equals()` メソッドのテストが無いことに気づけなかった
- P.65 の第10章のリファクタリングの考え方を一人で実践できる気がしない。
- P.xx 全体のリファクタリングの流れを自分で実現できる気がしない。
- P.82 Imposterパターンが何かがわからない。
- P90 第13章の開発の進め方がわからない。
     - 各テストの狙いなどが整理できていない。
     - SumオブジェクトとMoneyオブジェクトが循環参照になってしまう。
        - Javaのパッケージのアクセス範囲を再現する方法が必要かも
        - `from import` ではなく `import` を使うことで解決できるかもしれない
            - [参考](https://www.web-dev-qa-db-ja.com/ja/python/pythonで循環インポートを避ける方法は？/939940362/)
            - 解決はできた
- 第13章移行の `Expression(式)` のメタファーを理解できなかった。

##### 第二部
- P146. Pluggable Selectorパターンを適用したメリットはなにか？
- 全体　TDDではないが、 `Python` の `Import` に関するパスの解決手段が全く理解できない。。。


### 2回目
- 言語：Python
- 対象：第二部 xUnit

#### 学んだこと
##### テストの基本
- テストコードの必須要件の3A
    - 準備:     Arrange
    - 実行:     Act
    - アサート: Assert
- テストオブジェクトの共通化のトレードオフ
    - パフォーマンス: 同じ準備は時間がかかる
    - 独立性: テストアイテムの共通化はテストケース感の依存関係を作ってしまう
- Test Codeで一つのTestで他のテストをカバーできたら不要なテストを消すj:w
    - テストの重複はメンテナンスコストを上げるだけ
    - テストしないより、した方が良いは長期的に考えれば嘘

##### リファクタリングのパターン
- 異なる責務の分割
    - WasRunクラス(テストの実行状態の記録)とTestCaseクラス(テストの実行)
- Pluggable Selectorパターン
    - ハードコードによるメソッドの呼び出しを動的に切り替えられるようにする
    - 静的解析やコードの可読性が落ちる
    - TestCaseTestクラスで実行するTestを指定出来るようにするためにこのパターンで実装している
- 親クラスとサブクラスの責務の整理
    - メンバー変数のnameはTestCaseの名前のため引き上げ
    - run()メソッドは親クラスのメンバー変数しか使わないので引き上げ
- メソッドの抽出
    - メソッドをあるべきクラスに移動させる。
    - 実際に実行していたテストパターンをTestCaseTestクラスに移動した
- 不要なテストパターンは削って良い
    - 新しいパターン、他のパターンで確認できているAssertは削除しても良い
- 重複を削除するリファクタリングの後に重複がなくなったら一つに戻してしまう。
    - リファクタリングした後の変更で再度リファクタリングが必要になることはある
- Collecting Parameterパターン
    - 複数のオブジェクトの情報を集約する時に使える。
    - 情報集約用のオブジェクトを外部で作って依存性注入を行うことで記録する
    - 引数のオブジェクトを書き換える `副作用のあるメソッド` になることに注意


#### わからなかったこと
- nameはTestCaseクラスにすればいいの判断の理由があっているかわからない

## 書籍情報
- [テスト駆動開発](https://www.amazon.co.jp/%E3%83%86%E3%82%B9%E3%83%88%E9%A7%86%E5%8B%95%E9%96%8B%E7%99%BA-Kent-Beck/dp/4274217884/ref=sr_1_2?__mk_ja_JP=%E3%82%AB%E3%82%BF%E3%82%AB%E3%83%8A&crid=25K57BGJDY9NC&keywords=%E3%83%86%E3%82%B9%E3%83%88%E9%A7%86%E5%8B%95&qid=1677750275&sprefix=%E3%83%86%E3%82%B9%E3%83%88%E9%A7%86%E5%8B%95%2Caps%2C191&sr=8-2)
